{"version":3,"file":"HeadingIndicator.js","sourceRoot":"","sources":["../../../pfd/components/HeadingIndicator.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,cAAc,EAAE,MAAM,YAAY,CAAC;AAC5C,OAAO,EAAE,gBAAgB,EAAY,WAAW,EAAS,MAAM,SAAS,CAAC;AAEzE,OAAO,EAAE,gBAAgB,EAAE,MAAM,iBAAiB,CAAC;AAEnD,MAAM,YAAY,GAAG,EAAE,CAAC;AACxB,MAAM,eAAe,GAAG,KAAK,CAAC;AAC9B,MAAM,YAAY,GAAG,CAAC,CAAC;AAEvB,MAAM,iBAAkB,SAAQ,gBAAmD;IAG/E,MAAM;QACF,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,IAAI,SAAS,GAAG,EAAE,CAAC;QACnB,IAAI,UAAU,GAAG,MAAM,CAAC;QACxB,IAAI,QAA4B,CAAC;QAEjC,MAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QACtD,IAAI,cAAc,GAAG,EAAE,KAAK,CAAC,EAAE;YAC3B,IAAI,cAAc,GAAG,EAAE,KAAK,CAAC,EAAE;gBAC3B,SAAS,GAAG,YAAY,CAAC;gBACzB,QAAQ,GAAG,SAAS,CAAC;aACxB;iBAAM;gBACH,SAAS,GAAG,cAAc,CAAC;gBAC3B,QAAQ,GAAG,SAAS,CAAC;aACxB;YACD,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC;YACvD,IAAI,OAAO,GAAG,CAAC,EAAE;gBACb,OAAO,IAAI,EAAE,CAAC;aACjB;YACD,IAAI,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC;SAC7B;aAAM;YACH,UAAU,IAAI,IAAI,CAAC;SACtB;QACD,OAAO,CACH,kCAAG,EAAE,EAAC,aAAa,EAAC,SAAS,EAAE,aAAa,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK;YAC9D,qCAAM,KAAK,EAAC,oBAAoB,EAAC,CAAC,EAAE,kBAAkB,UAAU,EAAE,GAAI;YACtE,qCAAM,EAAE,EAAC,cAAc,EAAC,KAAK,EAAE,qBAAqB,SAAS,EAAE,EAAE,CAAC,EAAC,WAAW,EAAC,CAAC,EAAE,QAAQ,IAAG,IAAI,CAAQ,CACzG,CACP,CAAC;IACN,CAAC;CAEJ;AAAA,CAAC;AAMF,MAAM,OAAO,WAAY,SAAQ,gBAAkC;IAG/D,MAAM;QAEL;;;eAGO;QACA,MAAM,IAAI,GAAG,EAAgB,CAAC;QAC9B,OAAO,CACP;YACI,qCAAM,EAAE,EAAC,uBAAuB,EAAC,CAAC,EAAC,uCAAuC,EAAC,KAAK,EAAC,gBAAgB,GAAG;YACpG,2BAAC,cAAc;YACX,mDAAmD;;gBAAnD,mDAAmD;gBACnD,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,EACnB,IAAI,EAAE,IAAI,EACV,YAAY,EAAE,YAAY,GAAG,CAAC,EAC9B,YAAY,EAAE,YAAY,EAC1B,eAAe,EAAE,eAAe,GAClC,CACF,CACP,CAAC;IACN,CAAC;CAEJ;AASD,MAAM,CAAC,MAAM,cAAc,GAAG,CAAC,EAAE,eAAe,EAAE,OAAO,EAAE,SAAS,EAAE,WAAW,EAAuB,EAAE,EAAE;IACxG,IAAI,CAAC,OAAO,CAAC,iBAAiB,EAAE,EAAE;QAC9B,OAAO,CACH;YACI,qCAAM,EAAE,EAAC,uBAAuB,EAAC,CAAC,EAAC,uCAAuC,EAAC,KAAK,EAAC,gBAAgB,GAAG;YACpG,qCAAM,EAAE,EAAC,oBAAoB,EAAC,KAAK,EAAC,kBAAkB,EAAC,CAAC,EAAC,sCAAsC,GAAG;YAClG,qCAAM,EAAE,EAAC,aAAa,EAAC,KAAK,EAAC,wCAAwC,EAAC,CAAC,EAAC,WAAW,EAAC,CAAC,EAAC,WAAW,UAAW,CAC7G,CACN,CAAC;KACL;IAED,OAAO,CACH,kCAAG,EAAE,EAAC,qBAAqB;QACvB,qCAAM,EAAE,EAAC,oBAAoB,EAAC,KAAK,EAAC,oBAAoB,EAAC,CAAC,EAAC,sCAAsC,GAAG;QACpG,2BAAC,eAAe,IAAC,OAAO,EAAE,OAAO,EAAE,eAAe,EAAE,eAAe,GAAI;QACvE,2BAAC,YAAY,IAAC,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,SAAS,GAAI;QACxD,qCAAM,KAAK,EAAC,aAAa,EAAC,CAAC,EAAC,uCAAuC,GAAG;QACpE,WAAW,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC,2BAAC,cAAc,IAAC,WAAW,EAAE,WAAW,EAAE,OAAO,EAAE,OAAO,GAAI,CAAC,CAAC,CAAC,IAAI,CACzG,CACP,CAAC;AACN,CAAC,CAAC;AAOF,MAAM,eAAe,GAAG,CAAC,EAAE,eAAe,EAAE,OAAO,EAAwB,EAAE,EAAE;IAC3E,IAAI,MAAM,CAAC,KAAK,CAAC,eAAe,CAAC,EAAE;QAC/B,OAAO,IAAI,CAAC;KACf;IAED,MAAM,YAAY,GAAG,gBAAgB,CAAC,eAAe,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;IACtE,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IACrE,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,YAAY,EAAE;QACvC,MAAM,MAAM,GAAG,YAAY,GAAG,eAAe,GAAG,YAAY,CAAC;QAE7D,OAAO,CACH,qCAAM,EAAE,EAAC,wBAAwB,EAAC,KAAK,EAAC,+BAA+B,EAAC,SAAS,EAAE,aAAa,MAAM,KAAK,EAAE,CAAC,EAAC,mDAAmD,GAAG,CACxK,CAAC;KACL;IAAC,IAAI,YAAY,GAAG,CAAC,EAAE;QACpB,OAAO,CACH,qCAAM,EAAE,EAAC,0BAA0B,EAAC,KAAK,EAAC,+BAA+B,EAAC,CAAC,EAAC,WAAW,EAAC,CAAC,EAAC,WAAW,IAAE,IAAI,CAAQ,CACtH,CAAC;KACL;IACD,OAAO,CACH,qCAAM,EAAE,EAAC,yBAAyB,EAAC,KAAK,EAAC,+BAA+B,EAAC,CAAC,EAAC,UAAU,EAAC,CAAC,EAAC,WAAW,IAAE,IAAI,CAAQ,CACpH,CAAC;AACN,CAAC,CAAC;AAOF,MAAM,cAAc,GAAG,CAAC,EAAE,OAAO,EAAE,WAAW,EAAuB,EAAE,EAAE;IACrE,MAAM,MAAM,GAAG,gBAAgB,CAAC,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,GAAG,eAAe,GAAG,YAAY,CAAC;IACnG,OAAO,CACH,kCAAG,EAAE,EAAC,sBAAsB,EAAC,SAAS,EAAE,aAAa,MAAM,KAAK;QAC5D,qCAAM,KAAK,EAAC,0BAA0B,EAAC,CAAC,EAAC,2DAA2D,GAAG;QACvG,qCAAM,KAAK,EAAC,+BAA+B,EAAC,CAAC,EAAC,2DAA2D,GAAG,CAC5G,CACP,CAAC;AACN,CAAC,CAAC;AAOF,MAAM,YAAY,GAAG,CAAC,EAAE,SAAS,EAAE,OAAO,EAAqB,EAAE,EAAE;IAC/D,IAAI,SAAS,GAAG,CAAC,EAAE;QACf,OAAO,IAAI,CAAC;KACf;IAED,MAAM,KAAK,GAAG,gBAAgB,CAAC,SAAS,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;IACzD,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAC/D,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,YAAY,EAAE;QAChC,IAAI,KAAK,GAAG,CAAC,EAAE;YACX,OAAO,CACH,kCAAG,EAAE,EAAC,gBAAgB;gBAClB,qCAAM,KAAK,EAAC,8BAA8B,EAAC,CAAC,EAAC,uCAAuC,GAAG;gBACvF,qCAAM,EAAE,EAAC,oBAAoB,EAAC,KAAK,EAAC,gCAAgC,EAAC,CAAC,EAAC,WAAW,EAAC,CAAC,EAAC,WAAW,IAAE,IAAI,CAAQ,CAC9G,CACP,CAAC;SACL;QACD,OAAO,CACH,kCAAG,EAAE,EAAC,eAAe;YACjB,qCAAM,KAAK,EAAC,8BAA8B,EAAC,CAAC,EAAC,uCAAuC,GAAG;YACvF,qCAAM,EAAE,EAAC,mBAAmB,EAAC,KAAK,EAAC,gCAAgC,EAAC,CAAC,EAAC,UAAU,EAAC,CAAC,EAAC,WAAW,IAAE,IAAI,CAAQ,CAC5G,CACP,CAAC;KACL;IAED,MAAM,MAAM,GAAG,gBAAgB,CAAC,SAAS,EAAE,OAAO,CAAC,KAAK,CAAC,GAAG,eAAe,GAAG,YAAY,CAAC;IAC3F,OAAO,CACH,kCAAG,EAAE,EAAC,kBAAkB,EAAC,SAAS,EAAE,aAAa,MAAM,KAAK;QACxD,qCAAM,KAAK,EAAC,cAAc,EAAC,CAAC,EAAC,4CAA4C,GAAG;QAC5E,qCAAM,KAAK,EAAC,qBAAqB,EAAC,CAAC,EAAC,4CAA4C,GAAG,CACnF,CACP,CAAC;AACN,CAAC,CAAC","sourcesContent":["import { HorizontalTape } from './PFDUtils';\r\nimport { DisplayComponent, EventBus, FSComponent, VNode } from 'msfssdk';\r\nimport { Arinc429Word } from '../shared/arinc429';\r\nimport { getSmallestAngle } from '../shared/utils';\r\n\r\nconst DisplayRange = 24;\r\nconst DistanceSpacing = 7.555;\r\nconst ValueSpacing = 5;\r\n\r\nclass GraduationElement extends DisplayComponent<{heading: number, offset: number}>  {\r\n   \r\n\r\n    render(): VNode {\r\n        let text = '';\r\n        let classText = '';\r\n        let tickLength = 3.8302;\r\n        let textYPos: number | undefined;\r\n    \r\n        const roundedHeading = Math.round(this.props.heading);\r\n        if (roundedHeading % 10 === 0) {\r\n            if (roundedHeading % 30 === 0) {\r\n                classText = 'FontMedium';\r\n                textYPos = 154.64206;\r\n            } else {\r\n                classText = 'FontSmallest';\r\n                textYPos = 154.27985;\r\n            }\r\n            let textVal = Math.round(this.props.heading / 10) % 36;\r\n            if (textVal < 0) {\r\n                textVal += 36;\r\n            }\r\n            text = textVal.toString();\r\n        } else {\r\n            tickLength *= 0.42;\r\n        }\r\n        return (\r\n            <g id=\"HeadingTick\" transform={`translate(${this.props.offset} 0)`}>\r\n                <path class=\"NormalStroke White\" d={`m68.913 145.34v${tickLength}`} />\r\n                <text id=\"HeadingLabel\" class={`White MiddleAlign ${classText}`} x=\"68.879425\" y={textYPos}>{text}</text>\r\n            </g>\r\n        );\r\n    }\r\n  \r\n};\r\n\r\ninterface HeadingTapeProps {\r\n    bus: EventBus;\r\n}\r\n\r\nexport class HeadingTape extends DisplayComponent<HeadingTapeProps> {\r\n  \r\n  \r\n    render(): VNode {\r\n     \r\n     /*        if (!this.props.heading.isNormalOperation()) {\r\n                return <></>;\r\n            }\r\n          */\r\n            const bugs = [] as [number][];\r\n            return (\r\n            <g>\r\n                <path id=\"HeadingTapeBackground\" d=\"m32.138 145.34h73.536v10.382h-73.536z\" class=\"TapeBackground\" />\r\n                <HorizontalTape\r\n                    /* graduationElementFunction={GraduationElement} */\r\n                    bus={this.props.bus}\r\n                    bugs={bugs}\r\n                    displayRange={DisplayRange + 3}\r\n                    valueSpacing={ValueSpacing}\r\n                    distanceSpacing={DistanceSpacing}\r\n                />\r\n            </g>\r\n        );\r\n    }\r\n  \r\n}\r\n\r\ninterface HeadingOfftapeProps {\r\n    selectedHeading: number;\r\n    heading: Arinc429Word;\r\n    ILSCourse: number;\r\n    groundTrack: Arinc429Word;\r\n}\r\n\r\nexport const HeadingOfftape = ({ selectedHeading, heading, ILSCourse, groundTrack }: HeadingOfftapeProps) => {\r\n    if (!heading.isNormalOperation()) {\r\n        return (\r\n            <>\r\n                <path id=\"HeadingTapeBackground\" d=\"m32.138 145.34h73.536v10.382h-73.536z\" class=\"TapeBackground\" />\r\n                <path id=\"HeadingTapeOutline\" class=\"NormalStroke Red\" d=\"m32.138 156.23v-10.886h73.536v10.886\" />\r\n                <text id=\"HDGFailText\" class=\"Blink9Seconds FontLargest EndAlign Red\" x=\"75.926208\" y=\"151.95506\">HDG</text>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <g id=\"HeadingOfftapeGroup\">\r\n            <path id=\"HeadingTapeOutline\" class=\"NormalStroke White\" d=\"m32.138 156.23v-10.886h73.536v10.886\" />\r\n            <SelectedHeading heading={heading} selectedHeading={selectedHeading} />\r\n            <QFUIndicator heading={heading} ILSCourse={ILSCourse} />\r\n            <path class=\"Fill Yellow\" d=\"m69.61 147.31h-1.5119v-8.0635h1.5119z\" />\r\n            { groundTrack.isNormalOperation() ? <GroundTrackBug groundTrack={groundTrack} heading={heading} /> : null }\r\n        </g>\r\n    );\r\n};\r\n\r\ninterface SelectedHeadingProps {\r\n    selectedHeading: number;\r\n    heading: Arinc429Word;\r\n}\r\n\r\nconst SelectedHeading = ({ selectedHeading, heading }: SelectedHeadingProps) => {\r\n    if (Number.isNaN(selectedHeading)) {\r\n        return null;\r\n    }\r\n\r\n    const headingDelta = getSmallestAngle(selectedHeading, heading.value);\r\n    const text = Math.round(selectedHeading).toString().padStart(3, '0');\r\n    if (Math.abs(headingDelta) < DisplayRange) {\r\n        const offset = headingDelta * DistanceSpacing / ValueSpacing;\r\n\r\n        return (\r\n            <path id=\"HeadingTargetIndicator\" class=\"NormalStroke Cyan CornerRound\" transform={`translate(${offset} 0)`} d=\"m69.978 145.1 1.9501-5.3609h-6.0441l1.9501 5.3609\" />\r\n        );\r\n    } if (headingDelta > 0) {\r\n        return (\r\n            <text id=\"SelectedHeadingTextRight\" class=\"FontSmallest MiddleAlign Cyan\" x=\"101.56478\" y=\"144.44759\">{text}</text>\r\n        );\r\n    }\r\n    return (\r\n        <text id=\"SelectedHeadingTextLeft\" class=\"FontSmallest MiddleAlign Cyan\" x=\"36.20676\" y=\"144.44794\">{text}</text>\r\n    );\r\n};\r\n\r\ninterface GroundTrackBugProps {\r\n    heading: Arinc429Word;\r\n    groundTrack: Arinc429Word;\r\n}\r\n\r\nconst GroundTrackBug = ({ heading, groundTrack }: GroundTrackBugProps) => {\r\n    const offset = getSmallestAngle(groundTrack.value, heading.value) * DistanceSpacing / ValueSpacing;\r\n    return (\r\n        <g id=\"ActualTrackIndicator\" transform={`translate(${offset} 0)`}>\r\n            <path class=\"ThickOutline CornerRound\" d=\"m68.906 145.75-1.2592 1.7639 1.2592 1.7639 1.2592-1.7639z\" />\r\n            <path class=\"ThickStroke Green CornerRound\" d=\"m68.906 145.75-1.2592 1.7639 1.2592 1.7639 1.2592-1.7639z\" />\r\n        </g>\r\n    );\r\n};\r\n\r\ninterface QFUIndicatorProps {\r\n    ILSCourse: number;\r\n    heading: Arinc429Word;\r\n}\r\n\r\nconst QFUIndicator = ({ ILSCourse, heading }: QFUIndicatorProps) => {\r\n    if (ILSCourse < 0) {\r\n        return null;\r\n    }\r\n\r\n    const delta = getSmallestAngle(ILSCourse, heading.value);\r\n    const text = Math.round(ILSCourse).toString().padStart(3, '0');\r\n    if (Math.abs(delta) > DisplayRange) {\r\n        if (delta > 0) {\r\n            return (\r\n                <g id=\"ILSCourseRight\">\r\n                    <path class=\"BlackFill NormalStroke White\" d=\"m100.57 149.68h12.088v6.5516h-12.088z\" />\r\n                    <text id=\"ILSCourseTextRight\" class=\"FontMedium MiddleAlign Magenta\" x=\"106.58398\" y=\"155.12291\">{text}</text>\r\n                </g>\r\n            );\r\n        }\r\n        return (\r\n            <g id=\"ILSCourseLeft\">\r\n                <path class=\"BlackFill NormalStroke White\" d=\"m26.094 156.18v-6.5516h12.088v6.5516z\" />\r\n                <text id=\"ILSCourseTextLeft\" class=\"FontMedium MiddleAlign Magenta\" x=\"32.06773\" y=\"155.12303\">{text}</text>\r\n            </g>\r\n        );\r\n    }\r\n\r\n    const offset = getSmallestAngle(ILSCourse, heading.value) * DistanceSpacing / ValueSpacing;\r\n    return (\r\n        <g id=\"ILSCoursePointer\" transform={`translate(${offset} 0)`}>\r\n            <path class=\"ThickOutline\" d=\"m66.992 152.82h3.8279m-1.914-6.5471v9.4518\" />\r\n            <path class=\"ThickStroke Magenta\" d=\"m66.992 152.82h3.8279m-1.914-6.5471v9.4518\" />\r\n        </g>\r\n    );\r\n};\r\n"]}